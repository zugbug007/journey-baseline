### Journey Performance

```{r top_bot_journeys, echo=FALSE, fig.height=7, fig.width=9}
  top_bot
```

### Baseline Summary

Below is a summary of the website journeys looking at data from **`r format(pre_start_date, "%b %d")` to `r format(last_valid_date, "%b %d")`**.  
This table is sorted by the difference between the baseline and the new site baseline difference percentage.
Poor performing new journeys should come to the top.

```{r baseline, echo=FALSE}
baseline_visits_mean <- baseline_summary %>% 
  select(journey_name, Visits_mean.a.pre, Visits_mean.b.post) %>% 
  mutate(visits_diff = round(((Visits_mean.b.post - Visits_mean.a.pre)/Visits_mean.a.pre)*100, digits = 1)) %>% 
  arrange(visits_diff) %>% 
  top_n(-10, visits_diff) %>% 
  kable(col.names = c("Journey Name", "Baseline Visits", "New Site Visits Avg.", "% Visits Diff.")) %>% 
  kable_styling(bootstrap_options = c("striped", "condensed"), full_width = F)

baseline_visits_mean

```

Below is a summary of the total number of journeys which are higher or lower than their baseline.

```{r summary_table_high_low, echo=FALSE}

high_low_table

```


### Journey Heatmap

```{r journey_heatmap, echo=FALSE, fig.height=10, fig.width=13, message=FALSE, warning=FALSE}
# OrRd, RdYlGn, BuPu, Blues, Greens, Greys,GnBu, PuBuGn, PuRd, RdPu, YlGn,YlGnBu, YlOrBr, YlOrRd, Oranges, Purples, Reds

library (d3heatmap)

   d3heatmap(heatmap_visits_by_day, dendrogram = 'none', key = FALSE, col = 'RdYlGn', 
          labRow = heatmap_visits_by_day$journey_name, labRowSize = 150,
          scale = 'row', print.values = F,
          notecol = 'red', anim_duration = 0, cellnote_val = "Visits") %>% 
  hmAxis("x", title = "Day", location = 'bottom', angle = 90, font.size = '5px') %>% 
  hmAxis("y", title = "Journey Name", location = 'right', font.size = '10px') %>% 
  hmCells(font.size = 10, color = 'blue')# %>% 
  #hmLegend(show = T, title = "Title", location = "tl")
  
  # d3heatmap(heatmap_anomalies_by_day, dendrogram = 'none', key = FALSE, col = 'RdPu',
  #            labRow = heatmap_anomalies_by_day$journey_name, labColSize = 3,
  #            scale = 'row', key.title = "Legend", print.values = F,
  #            notecol = 'red') %>%
  #    hmAxis("x", title = "Day", location = 'bottom', angle = 90) %>%
  #    hmAxis("y", title = "Journey", location = 'left') %>%
  #    hmCells(font.size = 10, color = 'blue') %>%
  #    hmLegend(show = F, title = "Title", location = "tl")
  detach("package:d3heatmap", unload = TRUE)  

```


### Anomaly Analysis By Journey
Below is the count of anomalies detected for each journey, this is sorted by the number detected in the post launch period.
Journeys higher up this list will need more investigation than lower journeys.  

Positive anomalies are where the visit data exceeded the upper boundary of the data window.
Negative anomalies are where the visit data fell below the lower boundary of the data window.
The Net value is an overall count of the anomalies: (Positive Anomalies - Negative Anomalies = Net).

Higher negative values for Net columns indicate the journey fell below the expected amounts for the journey. 
1 Anomaly = 1 day where the data was above or below expectations.

```{r anomaly_net_table, echo=FALSE, fig.height=7, fig.width=9}
# Build Cont Table of Anomalies for each journey. Get the number POST change so identify biggest differences after the cut over.

anomaly_count

```


